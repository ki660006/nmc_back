Imports System.Windows.Forms
Imports System.IO
Imports System.Xml

Imports DBORA.DbProvider
Imports COMMON.CommFN
Imports COMMON.CommLogin.LOGIN
Imports COMMON.SVar

Public Class CGWEB_G


    Public Function ExecuteDo(ByVal r_stu As STU_GVINFO) As String
        Dim sFn As String = "Public Function ExecuteDo(ArrayList) As Boolean"

        Try
            COMMON.CommFN.MdiMain.DB_Active_YN = "Y"

            Dim sRetVal As String = ""

            Dim sURL = ""
            Dim wbReq As Net.WebRequest
            Dim wbRep As Net.WebResponse

#If DEBUG Then
            sURL += PRG_CONST.SERVERIP_DEV
#Else
            sURL += PRG_CONST.SERVERIP
#End If

            sURL += "/webapps/com/commonweb/xrw/.live?submit_id=TXLIW00401&business_id=lis"
            sURL += "&regno=" + r_stu.REGNO
            sURL += "&status=" + r_stu.STATUS
            sURL += "&deptcd=" + IIf(r_stu.DEPTCD_USR = "", "2200000000", r_stu.DEPTCD_USR).ToString
            sURL += "&deptnm=" + IIf(r_stu.DEPTNM_USR = "", "진단검사의학과", r_stu.DEPTNM_USR).ToString
            sURL += "&usrid=" + IIf(USER_INFO.USRID.IndexOf("ACK") >= 0, "210003", USER_INFO.USRID).ToString
            sURL += "&usrnm=" + IIf(USER_INFO.USRID.IndexOf("ACK") >= 0, "정보경", USER_INFO.USRID).ToString
            sURL += "&ordcd=" + r_stu.ORDCD
            sURL += "&sugacd=" + r_stu.SUGACD
            sURL += "&spccd=" + r_stu.SPCCD
            sURL += "&ioflag=" + "I"
            sURL += "&"

            wbReq = Net.WebRequest.Create(sURL)
            wbRep = wbReq.GetResponse()

            Dim sr As System.IO.StreamReader = New System.IO.StreamReader(wbRep.GetResponseStream(), System.Text.Encoding.UTF8)
            sRetVal = fnGet_XmlParsing(sr)

            Return sRetVal

        Catch ex As Exception
            Throw (New Exception(ex.Message + " @" + sFn, ex))
        Finally
            COMMON.CommFN.MdiMain.DB_Active_YN = ""
        End Try
    End Function


    Private Function fnGet_XmlParsing(ByVal r_sr As System.IO.StreamReader) As String

        Dim sFn As String = "fnGet_XmlParsing"

        Dim xmlReader As XmlTextReader = New Xml.XmlTextReader(r_sr)
        Dim sValue As String = ""

        Try
            While xmlReader.Read()
                Select Case xmlReader.NodeType
                    Case XmlNodeType.Comment
                    Case XmlNodeType.Element
                        If xmlReader.Name.ToLower = "data" Then
                            If sValue <> "" Then
                                sValue += Chr(4)
                            End If
                        End If
                    Case XmlNodeType.EndEntity
                    Case XmlNodeType.Text
                        sValue += xmlReader.Value.Trim + Chr(3)
                    Case XmlNodeType.CDATA
                        sValue += xmlReader.Value.Trim + Chr(3)
                    Case Else
                End Select
            End While

        Catch ex As XmlException
            Throw (New Exception(ex.Message, ex))

        Finally
            xmlReader.Close()
        End Try

        Return sValue

    End Function
End Class
